<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ferkashops ‚Äî Marketplace (Modern Demo)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#0ea5e9"/>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; }
    .line-clamp-1 { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  </style>
</head>
<body class="bg-gradient-to-br from-sky-50 to-teal-50 dark:from-slate-900 dark:to-slate-800 min-h-screen transition-colors">
  <!-- Header -->
  <header class="sticky top-0 z-30 bg-white/90 dark:bg-slate-900/90 backdrop-blur border-b border-slate-200 dark:border-slate-700">
    <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-2">
        <div class="w-9 h-9 rounded-2xl bg-gradient-to-br from-sky-500 to-teal-500"></div>
        <h1 class="text-2xl font-bold bg-gradient-to-r from-sky-500 to-teal-500 bg-clip-text text-transparent">Ferkashops</h1>
        <span class="ml-2 text-xs px-2 py-1 rounded-full bg-sky-100 text-sky-700 dark:bg-sky-900/40 dark:text-sky-200">demo</span>
      </div>
      <div class="flex gap-2 items-center w-full md:w-auto">
        <input id="search" class="flex-1 md:w-[480px] rounded-2xl border border-slate-200 px-4 py-2 outline-none focus:ring-2 focus:ring-sky-400 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-200" placeholder="Nima qidiryapsiz? (masalan: iPhone, velosiped)"/>
        <button id="darkToggle" class="p-2 rounded-xl border border-slate-200 dark:border-slate-700" title="Dark/Light">üåô</button>
      </div>
    </div>
  </header>

  <!-- Filters -->
  <section class="max-w-7xl mx-auto px-4 mt-4 grid grid-cols-2 md:grid-cols-6 gap-2">
    <select id="categoryFilter" class="rounded-xl border border-slate-200 px-3 py-2 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-200">
      <option value="">Barcha kategoriyalar</option>
    </select>
    <select id="locationFilter" class="rounded-xl border border-slate-200 px-3 py-2 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-200 col-span-1">
      <option value="">Barcha joylashuvlar</option>
    </select>
    <select id="sort" class="rounded-xl border border-slate-200 px-3 py-2 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-200">
      <option value="new">Yangi avval</option>
      <option value="cheap">Narx: arzon ‚Üí qimmat</option>
      <option value="expensive">Narx: qimmat ‚Üí arzon</option>
    </select>
    <input id="minPrice" type="number" min="0" placeholder="Min narx" class="rounded-xl border border-slate-200 px-3 py-2 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-200"/>
    <input id="maxPrice" type="number" min="0" placeholder="Max narx" class="rounded-xl border border-slate-200 px-3 py-2 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-200"/>
    <label class="flex items-center gap-2 justify-center md:justify-start px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-700 cursor-pointer select-none">
      <input id="favOnly" type="checkbox" class="accent-sky-500">
      <span class="text-sm text-slate-700 dark:text-slate-200">Faqat sevimlilar</span>
    </label>
  </section>

  <!-- Listings -->
  <main class="max-w-7xl mx-auto px-4 py-6">
    <div id="cards" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
    <div id="emptyState" class="hidden text-center py-16 text-slate-500 dark:text-slate-400">Hech narsa topilmadi. Filtrlarni o'zgartirib ko'ring.</div>
    <div class="flex justify-center mt-6">
      <button id="loadMore" class="px-5 py-2 rounded-2xl bg-slate-900 text-white dark:bg-white dark:text-slate-900 hidden">Yana yuklash</button>
    </div>
  </main>

  <!-- Modal -->
  <div id="modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur flex items-center justify-center z-50">
    <div class="bg-white dark:bg-slate-900 rounded-2xl max-w-lg w-full p-4 relative">
      <button id="closeModal" class="absolute top-3 right-3 text-xl" title="Yopish">‚úñ</button>
      <div class="relative">
        <img id="mImage" class="w-full rounded-xl aspect-video object-cover bg-slate-100"/>
        <div class="absolute bottom-3 right-3 flex gap-2">
          <button id="prevImg" class="px-2 py-1 rounded-lg bg-white/80 dark:bg-slate-800/80">‚óÄ</button>
          <button id="nextImg" class="px-2 py-1 rounded-lg bg-white/80 dark:bg-slate-800/80">‚ñ∂</button>
        </div>
      </div>
      <h2 id="mTitle" class="text-xl font-bold mt-3"></h2>
      <div class="flex items-center justify-between mt-1">
        <div id="mPrice" class="text-lg font-bold text-sky-600 dark:text-sky-400"></div>
        <button id="mFav" class="px-3 py-1 rounded-xl border border-slate-200 dark:border-slate-700" title="Sevimlilarga qo'shish">‚ô°</button>
      </div>
      <div id="mLocation" class="text-sm text-slate-500 dark:text-slate-400"></div>
      <p id="mDesc" class="mt-3 text-slate-700 dark:text-slate-300"></p>
      <div class="grid grid-cols-2 gap-2 mt-4">
        <button id="revealPhone" class="bg-gradient-to-r from-sky-500 to-teal-500 text-white py-2 rounded-xl font-semibold">Telefonni ko‚Äòrsatish</button>
        <button id="shareBtn" class="border border-slate-200 dark:border-slate-700 rounded-xl font-semibold">Ulashish</button>
      </div>
    </div>
  </div>

  <!-- Bottom nav (mobile) -->
  <nav class="fixed bottom-0 inset-x-0 bg-white/90 dark:bg-slate-900/90 backdrop-blur border-t border-slate-200 dark:border-slate-700 flex justify-around py-2 md:hidden">
    <button class="flex flex-col items-center text-sky-600"><span>üè†</span><span class="text-xs">Bosh sahifa</span></button>
    <button class="flex flex-col items-center"><span>üìÇ</span><span class="text-xs">Kategoriyalar</span></button>
    <button class="flex flex-col items-center"><span>üîç</span><span class="text-xs">Qidiruv</span></button>
    <button class="flex flex-col items-center"><span>‚ù§Ô∏è</span><span class="text-xs">Sevimli</span></button>
  </nav>

  <!-- Toast -->
  <div id="toast" class="pointer-events-none fixed bottom-20 left-1/2 -translate-x-1/2 hidden bg-black/80 text-white px-4 py-2 rounded-xl text-sm"></div>

  <script>
    // ==== State & helpers ====
    const q = sel => document.querySelector(sel);
    const qa = sel => Array.from(document.querySelectorAll(sel));
    const money = v => new Intl.NumberFormat('uz-UZ').format(v);
    const when = ts => new Date(ts).toLocaleDateString('uz-UZ');
    const uid = () => Math.random().toString(36).slice(2);
    const rand = arr => arr[Math.floor(Math.random()*arr.length)];

    const LS_THEME = 'fs_theme';
    const LS_FAVS = 'fs_favs_v1';

    const categories = ["Telefonlar","Kompyuterlar","Kiyim","Sport","Avto","Uy & Bog'","Boshqa"];
    const locations = ["Toshkent","Farg'ona","Namangan","Samarqand","Buxoro","Andijon","Xorazm"];
    const titles = [
      "iPhone 11 128GB","Gaming noutbuk","Velosiped","Adidas krossovka","Samsung televizor","Konditsioner",
      "Mashina akkumulyatori","Qishki kurtka","Sony PlayStation 5","Canon fotoapparat","Kiyim shkafi",
      "Stol-stul","Gilam","Toster","Changyutkich","Planshet","Monitor 27\"","Velotrenajyor","Shina 15\"","Smart soat"
    ];

    // Generate 50 random items with 3 images and masked phones
    const listings = [];
    for (let i=0;i<50;i++){
      const base = Math.floor(Math.random()*8000000)+500000;
      const phone = `9${Math.floor(0+Math.random()*9)} ${Math.floor(100+Math.random()*900)} ${Math.floor(10+Math.random()*90)} ${Math.floor(10+Math.random()*90)}`;
      listings.push({
        id: uid(),
        title: rand(titles),
        price: base,
        category: rand(categories),
        location: rand(locations),
        desc: "Tovar haqida qisqacha tavsif. Holati yaxshi, real xaridorga kelishiladi.",
        createdAt: Date.now()-Math.floor(Math.random()*1000*60*60*24*10),
        images: [
          `https://picsum.photos/seed/${i}-a/800/450`,
          `https://picsum.photos/seed/${i}-b/800/450`,
          `https://picsum.photos/seed/${i}-c/800/450`,
        ],
        phoneMasked: `+998 ** *** ** **`,
        phoneReal: `+998 ${phone}`,
      });
    }

    const state = {
      search: '', category: '', location: '', sort: 'new', min: '', max: '', favOnly: false,
      page: 1, pageSize: 20, current: null, imgIdx: 0, favs: new Set(JSON.parse(localStorage.getItem(LS_FAVS)||'[]'))
    };

    // ==== Theme ====
    const savedTheme = localStorage.getItem(LS_THEME);
    if (savedTheme === 'dark') document.documentElement.classList.add('dark');
    q('#darkToggle').addEventListener('click', ()=>{
      document.documentElement.classList.toggle('dark');
      localStorage.setItem(LS_THEME, document.documentElement.classList.contains('dark')?'dark':'light');
    });

    // ==== Populate filter selects ====
    function fillSelect(sel, list){
      const el = q(sel);
      list.forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; el.appendChild(o); });
    }
    fillSelect('#categoryFilter', categories);
    fillSelect('#locationFilter', locations);

    // ==== Filtering/sorting/paging ====
    function applyFilters(){
      let arr = [...listings];
      const s = state.search.toLowerCase();
      if (s) arr = arr.filter(v => v.title.toLowerCase().includes(s) || v.desc.toLowerCase().includes(s));
      if (state.category) arr = arr.filter(v => v.category === state.category);
      if (state.location) arr = arr.filter(v => v.location === state.location);
      if (state.min !== '') arr = arr.filter(v => v.price >= Number(state.min));
      if (state.max !== '') arr = arr.filter(v => v.price <= Number(state.max));
      if (state.favOnly) arr = arr.filter(v => state.favs.has(v.id));
      switch (state.sort){
        case 'cheap': arr.sort((a,b)=>a.price-b.price); break;
        case 'expensive': arr.sort((a,b)=>b.price-a.price); break;
        default: arr.sort((a,b)=>b.createdAt-a.createdAt);
      }
      return arr;
    }

    function render(){
      const list = applyFilters();
      const end = state.page * state.pageSize;
      const slice = list.slice(0, end);
      q('#cards').innerHTML = slice.map(cardTpl).join('');
      q('#emptyState').classList.toggle('hidden', list.length !== 0);
      q('#loadMore').classList.toggle('hidden', end >= list.length);
    }

    // ==== Card & Modal ====
    function favIcon(id){ return state.favs.has(id) ? '‚ù§Ô∏è' : '‚ô°'; }

    function cardTpl(v){
      return `
        <article class="bg-white dark:bg-slate-800 rounded-2xl p-3 shadow hover:shadow-xl transition transform hover:-translate-y-1 grid gap-2">
          <div class="relative">
            <img src="${v.images[0]}" alt="${v.title}" class="w-full aspect-video object-cover rounded-xl bg-slate-100"/>
            <button data-id="${v.id}" class="favBtn absolute top-2 right-2 px-2 py-1 rounded-lg bg-white/90 dark:bg-slate-900/70">${favIcon(v.id)}</button>
          </div>
          <h3 class="font-semibold line-clamp-1">${v.title}</h3>
          <div class="flex items-center justify-between mt-1">
            <div class="text-lg font-bold">${money(v.price)} UZS</div>
            <span class="text-xs px-2 py-1 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300">${v.category}</span>
          </div>
          <div class="text-xs text-slate-500 dark:text-slate-400">${v.location} ‚Ä¢ ${when(v.createdAt)}</div>
          <button data-id="${v.id}" class="openBtn mt-1 w-full rounded-xl border border-slate-200 dark:border-slate-700 py-2">Ko‚Äòrish</button>
        </article>`;
    }

    function openModal(id){
      const v = listings.find(x=>x.id===id);
      if (!v) return;
      state.current = v; state.imgIdx = 0;
      q('#mImage').src = v.images[state.imgIdx];
      q('#mTitle').textContent = v.title;
      q('#mPrice').textContent = money(v.price)+" UZS";
      q('#mLocation').textContent = v.location+" ‚Ä¢ "+when(v.createdAt);
      q('#mDesc').textContent = v.desc;
      q('#mFav').textContent = favIcon(v.id);
      q('#revealPhone').dataset.phone = v.phoneReal;
      q('#revealPhone').dataset.mask = v.phoneMasked;
      q('#revealPhone').textContent = 'Telefonni ko‚Äòrsatish';
      q('#modal').classList.remove('hidden');
    }

    q('#cards').addEventListener('click', (e)=>{
      const id = e.target?.dataset?.id;
      if (!id && !e.target.classList.contains('openBtn') && !e.target.classList.contains('favBtn')) return;
      if (e.target.classList.contains('openBtn')) return openModal(id);
      if (e.target.classList.contains('favBtn')){
        toggleFav(id); e.target.textContent = favIcon(id); showToast(state.favs.has(id)?'Sevimlilarga qo‚Äòshildi':'Sevimlilardan olib tashlandi'); return;
      }
    });

    q('#closeModal').addEventListener('click', ()=> q('#modal').classList.add('hidden'));
    q('#prevImg').addEventListener('click', ()=>{ if (!state.current) return; state.imgIdx=(state.imgIdx+state.current.images.length-1)%state.current.images.length; q('#mImage').src=state.current.images[state.imgIdx]; });
    q('#nextImg').addEventListener('click', ()=>{ if (!state.current) return; state.imgIdx=(state.imgIdx+1)%state.current.images.length; q('#mImage').src=state.current.images[state.imgIdx]; });

    // Fav in modal
    q('#mFav').addEventListener('click', ()=>{ if (!state.current) return; toggleFav(state.current.id); q('#mFav').textContent=favIcon(state.current.id); showToast(state.favs.has(state.current.id)?'Sevimlilarga qo‚Äòshildi':'Sevimlilardan olib tashlandi'); render(); });

    // Reveal phone & share
    q('#revealPhone').addEventListener('click', (e)=>{
      const btn = e.currentTarget; btn.textContent = btn.dataset.phone; navigator.clipboard?.writeText(btn.dataset.phone).catch(()=>{});
      showToast('Telefon raqam nusxalandi');
    });
    q('#shareBtn').addEventListener('click', async ()=>{
      if (!state.current) return;
      const text = `${state.current.title} ‚Äî ${money(state.current.price)} UZS`;
      const url = location.href.split('#')[0] + `#${state.current.id}`;
      try {
        if (navigator.share) { await navigator.share({ title: 'Ferkashops', text, url }); }
        else { await navigator.clipboard.writeText(url); showToast('Havola nusxalandi'); }
      } catch {}
    });

    // ==== Fav helpers ====
    function toggleFav(id){
      if (state.favs.has(id)) state.favs.delete(id); else state.favs.add(id);
      localStorage.setItem(LS_FAVS, JSON.stringify([...state.favs]));
    }

    // ==== Toast ====
    function showToast(msg){
      const t = q('#toast'); t.textContent = msg; t.classList.remove('hidden');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> t.classList.add('hidden'), 1600);
    }

    // ==== Filter events ====
    q('#search').addEventListener('input', e=>{ state.search=e.target.value; state.page=1; render(); });
    q('#categoryFilter').addEventListener('change', e=>{ state.category=e.target.value; state.page=1; render(); });
    q('#locationFilter').addEventListener('change', e=>{ state.location=e.target.value; state.page=1; render(); });
    q('#sort').addEventListener('change', e=>{ state.sort=e.target.value; state.page=1; render(); });
    q('#minPrice').addEventListener('input', e=>{ state.min=e.target.value; state.page=1; render(); });
    q('#maxPrice').addEventListener('input', e=>{ state.max=e.target.value; state.page=1; render(); });
    q('#favOnly').addEventListener('change', e=>{ state.favOnly=e.target.checked; state.page=1; render(); });

    // Paging
    q('#loadMore').addEventListener('click', ()=>{ state.page++; render(); });
    window.addEventListener('scroll', ()=>{ // small infinite scroll on mobile
      if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 200) {
        const list = applyFilters();
        if (state.page * state.pageSize < list.length){ state.page++; render(); }
      }
    });

    // Open from hash (share)
    window.addEventListener('load', ()=>{
      const id = location.hash.replace('#','');
      if (id) openModal(id);
    });

    // Initial render
    render();
  </script>
</body>
</html>
